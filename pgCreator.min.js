export default class AppRec{constructor({form:r,report:e,criteria:t=""}={}){if(!r&&!e)throw new Error("Either form or report must be provided");this.form=r,this.report=e,this.records=[],this.count="",this.criteria=t}_checkSDK(){if(!window.ZOHO?.CREATOR?.UTIL)throw new Error("Zoho Creator SDK not initialized")}_validateResponse(r,e="Zoho API call"){if(!r||"object"!=typeof r)throw new Error(`${e} returned an invalid response`);if(r.code&&3e3!==r.code)return[];if(r.code&&3e3!==r.code)throw new Error(`${e} failed (${r.code}): ${r.message||"Unknown error"}`);return"Count"===e?r.result||"":r.data||[]}_baseConfig(){return{}}_normalize(r){return r&&"object"==typeof r?{id:r.ID||r.id,...r}:r}clear(){this.records=[]}async create(r={}){if(this._checkSDK(),!this.form)throw new Error("Form name required for create");var e={form_name:this.form,payload:{data:r}};try{const t=await ZOHO.CREATOR.DATA.addRecords(e),o=this._validateResponse(t,"Create"),i=r;return i.id=o,this.records.push(this._normalize(i)),i}catch(r){throw alert(`Error create ${this.form}:`+JSON.stringify(r.responseText)),r}}async read(r="all",e=[]){this.clear();const t={report_name:this.report,criteria:this.criteria||"",field_config:r,max_records:1e3};e.length>0&&"custom"===r&&(t.fields=e);let o=!0,i=null;for(;o;){i?t.record_cursor=i:delete t.record_cursor;try{const r=await ZOHO.CREATOR.DATA.getRecords(t);if(3e3!=r.code)throw new Error(`Read failed (${r.code}): ${r.message||"Unknown error"}`);const e=this._validateResponse(r,"Read");this.records.push(...e.map(r=>this._normalize(r))),i=r.record_cursor,o=!!i}catch(r){return[]}}return this.records}async updateById(r,e={}){if(this._checkSDK(),!this.form)throw new Error("Form name required for update");if(!r)throw new Error("recordId is required");const t={report_name:this.report,id:r,payload:{data:e}},o=await ZOHO.CREATOR.DATA.updateRecordById(t),i=this._validateResponse(o,"Update");return this.records=i.map(r=>this._normalize(r)),this.records}async deleteById(r){if(this._checkSDK(),!this.form)throw new Error("Form name required for delete");if(!r)throw new Error("recordId is required");var e={report_name:this.report,id:r};try{const r=await ZOHO.CREATOR.DATA.deleteRecordById(e);this._validateResponse(r,"Delete")}catch(r){throw r}return!0}async countRecords(r=""){const e={report_name:this.report};r&&(e.criteria=r);try{const r=await ZOHO.CREATOR.DATA.getRecordCount(e),t=this._validateResponse(r,"Count");this.count=t.records_count}catch(r){throw r}return this.count}viewById(r){return this.records.find(e=>e.id===r)}viewByField(r,e){return this.records.filter(t=>t[r]===e)}sortBySubField(r,e,t=!0){this.records.sort((o,i)=>{const s=o[r]&&o[r][e]?o[r][e].toUpperCase():"",a=i[r]&&i[r][e]?i[r][e].toUpperCase():"";return s<a?t?-1:1:s>a?t?1:-1:0})}}export async function initZoho(r){const e=await ZOHO.CREATOR.UTIL.getInitParams(),t=await ZOHO.CREATOR.UTIL.getQueryParams(),o=t[r]?JSON.parse(t[r]):"",i=document.referrer||window.parent?.location?.href||"";try{if(i){const r=new URL(i);e.parentDomain=r.hostname}}catch(r){e.parentDomain=""}return{...e,...o}}export async function redirect(r,e,t){const o={action:r,url:e,window:t};await ZOHO.CREATOR.UTIL.navigateParentURL(o)}export function formatPhone(r){if("string"!=typeof r)return r;let e=r.replace(/\D/g,"");return 11===e.length&&e.startsWith("1")&&(e=e.slice(1)),10===e.length?`(${e.slice(0,3)}) ${e.slice(3,6)}-${e.slice(6)}`:r}